layui.use(["jquery", "layer"], function () { var currentUid = 100000; var $ = layui.jquery; var layer = layui.layer; var active = { agree: function (othis) { var li = othis.parents("li"), id = li.data("id"), from_group = li.data("fromGroup"), user = { username: li.data("name"), avatar: li.data("avatar"), sign: li.data("sign") }, type = li.data("type"); if (type == 0) { parent.layui.layim.setFriendGroup({ type: "friend", username: user.username, avatar: user.avatar, group: parent.layui.layim.cache().friend, submit: function (group, index) { handle(id, currentUid, 1, group, function (res) { if (res.code == 0) { parent.layui.layim.addList({ type: "friend", avatar: user.avatar, username: user.username, groupid: group, id: uid, sign: user.sign }); parent.layer.close(index); othis.parent().html("已同意") } else { layer.msg(res.msg) } }) } }) } else { handle(id, currentUid, 1, 0, function (res) { if (res.code == 0) { othis.parent().html("已同意") } else { layer.msg(res.msg) } }) } }, refuse: function (othis) { var li = othis.parents("li"), id = li.data("id"); layer.confirm("确定拒绝吗？", function (index) { handle(id, currentUid, 2, 0, function (res) { if (res.code != 0) { return layer.msg(res.msg) } layer.close(index); othis.parent().html("<em>已拒绝</em>") }) }) } }; var handle = function (id, uid, res, gid, callback) { $.post("/layim/apply/handle", { id: id, uid: uid, result: res, fgid: (gid || 0) }, function (result) { callback && callback(result) }) }; $("body").on("click", ".layui-btn", function () { var othis = $(this), type = othis.data("type"); active[type] ? active[type].call(this, othis) : "" }) });